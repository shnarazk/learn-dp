#!/usr/bin/env cbqn
lib â† â€¢Import "lib.bqn"

NewVariable â‡ {F init:
  val â‡ init
  Data â‡ { ğ•¤ â‹„ val }
  Set â‡ { F v: val â†© v }
}

_asFunction â‡ { w _s:
  Forward â‡ W
  Set â‡ { Forward â†© ğ• }
  Apply â‡ { NewVariable Forward ğ•©.val }
}

_followedBy_ â‡ { w _s_ x: (x.Forwardâˆ˜w.Forward) _asFunction }

x â† NewVariable 1
Square â† 2âŠ¸(â‹†Ëœ)_asFunction
x10 â† NewVariable 10
"Square x10"            lib.Debug (square.Apply x10).Data @
Exp â† â‹†_asFunction
"Exp x"                 lib.Debug (exp.Apply x).Data @
Ln â† â‹†â¼_asFunction
"Ln x10"                lib.Debug (ln.Apply x10).Data @
F â† Exp _followedBy_ Ln
"Lnâˆ˜Exp x10"            lib.Debug (f.Apply x10).Data @
G â† Square _followedBy_ Square
"Squareâˆ˜Square x10"     lib.Debug (g.Apply x10).Data @
Chain â† Square _followedBy_ Exp _followedBy_ Square
"Aâˆ˜Bâˆ˜C 0.5 should be 1.648"     lib.Debug (chain.Apply NewVariable 0.5).Data @
